<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì°½ì› ì„±ë¯¼ì—¬ìê³  í¬í„¸</title>
<style>
  body { font-family: Arial; margin:0; padding:0; background:#f0f2f5; }
  #main, #moreMenu { transition: all 0.3s; }
  #moreMenu { position:fixed; left:-25%; top:0; width:25%; height:100%; background:#fff; box-shadow:2px 0 5px rgba(0,0,0,0.2); padding:20px; overflow:auto; z-index:1000; }
  #moreMenu button{ display:block; margin:10px 0; width:100%; }
  header{ display:flex; justify-content:space-between; align-items:center; padding:10px; background:#2c3e50; color:white; }
  section{ margin:10px; padding:15px; background:white; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
  h2{ margin-top:0;}
  table{ border-collapse:collapse; width:100%; text-align:center;}
  th,td{ border:1px solid #ccc; padding:8px;}
  .calendar{ display:flex; flex-wrap:wrap; width:300px; margin-bottom:10px;}
  .day{ width:40px; height:40px; margin:2px; display:flex; align-items:center; justify-content:center; cursor:pointer; border-radius:5px;}
  .event{ background-color:#f39c12;color:white;}
  .mood-btn{ margin:3px; cursor:pointer; font-size:20px;}
  .mood-display{ margin-top:5px;}
  ul{ list-style:none; padding:0; }
  li{ margin-bottom:5px; cursor:pointer; }
  #bamboo-detail-list li{padding:5px; border-bottom:1px solid #eee;}
  .pagination button{ margin:2px; }
</style>
</head>
<body>
<div id="moreMenu">
  <button onclick="goPage('profile')">ê³„ì •</button>
  <button onclick="goPage('notice')">ê³µì§€</button>
  <button onclick="goPage('calendar')">ìº˜ë¦°ë”</button>
  <button onclick="goPage('timetable')">ì‹œê°„í‘œ</button>
  <button onclick="goPage('bamboo')">ëŒ€ë‚˜ë¬´ìˆ²</button>
  <button onclick="goPage('bus')">ì…”í‹€ë²„ìŠ¤</button>
</div>

<div id="main">
<header>
  <div>í¬í„¸</div>
  <div><button onclick="toggleMenu()">ë”ë³´ê¸°</button></div>
</header>

<section id="login-section">
  <h2>ë¡œê·¸ì¸</h2>
  <input id="login-id" placeholder="ì•„ì´ë””">
  <input id="login-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <button onclick="login()">ë¡œê·¸ì¸</button>
  <p>ê³„ì •ì´ ì—†ë‚˜ìš”? <button onclick="showSignup()">íšŒì›ê°€ì…</button></p>
</section>

<section id="signup-section" style="display:none">
  <h2>íšŒì›ê°€ì…</h2>
  <input id="signup-id" placeholder="ì•„ì´ë””">
  <input id="signup-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <input id="signup-grade" type="number" placeholder="í•™ë…„">
  <input id="signup-class" type="number" placeholder="ë°˜">
  <button onclick="signup()">ê°€ì…í•˜ê¸°</button>
  <button onclick="hideSignup()">ì·¨ì†Œ</button>
</section>

<section id="portal-section" style="display:none">
  <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>

  <section id="profile" style="display:none">
    <h2>ê°œì¸ í˜ì´ì§€</h2>
    <p>ì´ë¦„: <span id="profile-name"></span></p>
    <p>í•™ë…„/ë°˜: <span id="profile-gradeclass"></span></p>
    <p>ì•„ì´ë””: <span id="profile-id"></span></p>
    <p>ì§„ë¡œ: <input id="profile-career"></p>
  </section>

  <section id="notice" style="display:block">
    <h2>ê³µì§€</h2>
    <p>í™˜ì˜í•©ë‹ˆë‹¤!</p>
  </section>

  <section id="calendar" style="display:none">
    <h2>ìº˜ë¦°ë”</h2>
    <div>
      <button onclick="changeMonth(-1)">â—€ ì´ì „</button>
      <span id="calendar-month"></span>
      <button onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
    </div>
    <div class="calendar" id="calendar-grid"></div>
    <div id="mood-section"></div>
  </section>

  <section id="timetable" style="display:none">
    <h2>ì‹œê°„í‘œ</h2>
    <div id="timetable-table"></div>
  </section>

  <section id="bamboo" style="display:none">
    <h2>ëŒ€ë‚˜ë¬´ìˆ² ê²Œì‹œíŒ</h2>
    <button onclick="showBambooDetail()">ìì„¸íˆ ë³´ê¸°</button>
    <ul id="bamboo-list"></ul>
  </section>

  <section id="bus" style="display:none">
    <h2>ì…”í‹€ë²„ìŠ¤ ì •ë³´</h2>
    <ul id="bus-list"></ul>
  </section>
</section>

<section id="bamboo-detail" style="display:none">
  <h2>ëŒ€ë‚˜ë¬´ìˆ² ìƒì„¸ë³´ê¸°</h2>
  <button onclick="hideBambooDetail()">ë‹«ê¸°</button>
  <button onclick="showBambooWrite()">ê¸€ì“°ê¸°</button>
  <input type="text" id="bamboo-search" placeholder="ê²€ìƒ‰" oninput="searchBamboo()">
  <ul id="bamboo-detail-list"></ul>
  <div class="pagination" id="bamboo-pagination"></div>
</section>

<section id="bamboo-write" style="display:none">
  <h2>ê¸€ì“°ê¸°</h2>
  <textarea id="bamboo-write-text" rows="5" cols="50"></textarea><br>
  <button onclick="postBambooDetail()">ê²Œì‹œ</button>
  <button onclick="hideBambooWrite()">ì·¨ì†Œ</button>
</section>

<script>
let users = JSON.parse(localStorage.getItem('users')||"[]");
let currentUser=null;
let moreOpen=false;

function toggleMenu(){
  const menu=document.getElementById('moreMenu');
  if(moreOpen){ menu.style.left='-25%'; moreOpen=false;}
  else{ menu.style.left='0'; moreOpen=true;}
}

function showSignup(){ document.getElementById('login-section').style.display='none'; document.getElementById('signup-section').style.display='block'; }
function hideSignup(){ document.getElementById('signup-section').style.display='none'; document.getElementById('login-section').style.display='block'; }

function signup(){
  const id=document.getElementById('signup-id').value.trim();
  const pw=document.getElementById('signup-pw').value.trim();
  const grade=parseInt(document.getElementById('signup-grade').value);
  const cls=parseInt(document.getElementById('signup-class').value);
  if(!id||!pw||!grade||!cls){ alert("ëª¨ë“  í•­ëª© ì…ë ¥"); return;}
  if(users.some(u=>u.id===id)){ alert("ì•„ì´ë”” ì¡´ì¬"); return;}
  const newUser={id:id,password:pw,grade:grade,class:cls};
  users.push(newUser);
  localStorage.setItem('users',JSON.stringify(users));
  alert("íšŒì›ê°€ì… ì™„ë£Œ!");
  hideSignup();
}

function login(){
  const id=document.getElementById('login-id').value;
  const pw=document.getElementById('login-pw').value;
  const user=users.find(u=>u.id===id && u.password===pw);
  if(user){
    alert("ë¡œê·¸ì¸ ì„±ê³µ");
    currentUser=user;
    document.getElementById('login-section').style.display='none';
    document.getElementById('portal-section').style.display='block';
    showTimetable();
    renderBusInfo();
    renderCalendar();
    renderBamboo();
    showProfile();
  } else alert("ì•„ì´ë”” ë˜ëŠ” ë¹„ë²ˆ í‹€ë¦¼");
}

function logout(){
  currentUser=null;
  location.reload();
}

function goPage(id){
  const sections=['profile','notice','calendar','timetable','bamboo','bus'];
  sections.forEach(s=>document.getElementById(s).style.display='none');
  document.getElementById(id).style.display='block';
}

// ===== í”„ë¡œí•„ =====
function showProfile(){
  document.getElementById('profile-name').textContent=currentUser.id;
  document.getElementById('profile-gradeclass').textContent=currentUser.grade+'í•™ë…„ '+currentUser.class+'ë°˜';
  document.getElementById('profile-id').textContent=currentUser.id;
  document.getElementById('profile-career').value=currentUser.career||'';
}

// ===== ì‹œê°„í‘œ =====
function showTimetable(){
  const key=currentUser.grade+'-'+currentUser.class;
  const tableDiv=document.getElementById('timetable-table');
  tableDiv.innerHTML='';
  const table=document.createElement('table');
  const days=["ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ"];
  const thead=document.createElement('thead');
  const tr=document.createElement('tr');
  tr.innerHTML="<th>êµì‹œ</th>"+days.map(d=>"<th>"+d+"</th>").join('');
  thead.appendChild(tr); table.appendChild(thead);
  const tbody=document.createElement('tbody');
  const sample=[["êµ­ì–´","ìˆ˜í•™","ì˜ì–´","ê³¼í•™","ì²´ìœ¡"],["ì—­ì‚¬","ìŒì•…","ë¯¸ìˆ ","ì •ë³´","ì˜ì–´"],["ê³¼í•™","ì²´ìœ¡","êµ­ì–´","ìˆ˜í•™","ì˜ì–´"],["ì˜ì–´","ê³¼í•™","ì²´ìœ¡","ì—­ì‚¬","ìŒì•…"],["ìˆ˜í•™","êµ­ì–´","ì˜ì–´","ë¯¸ìˆ ","ì²´ìœ¡"]];
  for(let i=0;i<5;i++){
    const tr=document.createElement('tr');
    tr.innerHTML="<td>"+(i+1)+"êµì‹œ</td>"+sample[i].map(c=>"<td>"+c+"</td>").join('');
    tbody.appendChild(tr);
  }
  table.appendChild(tbody);
  tableDiv.appendChild(table);
}

// ===== ì…”í‹€ë²„ìŠ¤ =====
function renderBusInfo(){
  const busList=document.getElementById('bus-list');
  busList.innerHTML='';
  const buses=[{route:"Aì½”ìŠ¤",status:"ìš´í–‰ì¤‘",next:"08:30"},{route:"Bì½”ìŠ¤",status:"ì§€ì—°",next:"08:45"}];
  buses.forEach(b=>{
    const li=document.createElement('li');
    li.textContent=`${b.route} - ${b.status} (ë‹¤ìŒ: ${b.next})`;
    busList.appendChild(li);
  });
}

// ===== ìº˜ë¦°ë” =====
let currentMonth=new Date();
const events=[{date:"2025-09-05",title:"ì²´ìœ¡ëŒ€íšŒ"},{date:"2025-09-10",title:"ê³¼í•™ì „ì‹œíšŒ"}];
let moods=JSON.parse(localStorage.getItem('moods')||"{}");

function renderCalendar(){
  const cal=document.getElementById('calendar-grid'); cal.innerHTML='';
  const year=currentMonth.getFullYear();
  const month=currentMonth.getMonth();
  document.getElementById('calendar-month').textContent=`${year}ë…„ ${month+1}ì›”`;
  const firstDay=new Date(year,month,1).getDay();
  const lastDate=new Date(year,month+1,0).getDate();
  for(let i=0;i<firstDay;i++){ const d=document.createElement('div'); d.className='day'; d.style.visibility='hidden'; cal.appendChild(d);}
  for(let d=1;d<=lastDate;d++){
    const div=document.createElement('div'); div.className='day';
    const dateStr=`${year}-${(month+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
    div.textContent=d;
    if(events.some(e=>e.date===dateStr)){ div.classList.add('event'); div.onclick=()=>selectMood(dateStr);}
    cal.appendChild(div);
  }
}

function changeMonth(dir){ currentMonth.setMonth(currentMonth.getMonth()+dir); renderCalendar();}
function selectMood(date){
  const emojis=["ğŸ˜„","ğŸ˜“","ğŸ˜","ğŸ˜¢"];
  const sec=document.getElementById('mood-section'); sec.innerHTML=`<h3>${date} ë§ˆìŒì˜¨ë„</h3>`;
  emojis.forEach(e=>{
    const btn=document.createElement('button'); btn.textContent=e; btn.className='mood-btn';
    btn.onclick=()=>{ moods[date]=moods[date]||[]; moods[date].push(e); localStorage.setItem('moods',JSON.stringify(moods)); showMood(date);};
    sec.appendChild(btn);
  });
  showMood(date);
}
function showMood(date){
  const sec=document.getElementById('mood-section');
  const div=document.createElement('div'); div.className='mood-display';
  div.textContent=moods[date].join(' ');
  sec.appendChild(div);
  const moreBtn=document.createElement('button'); moreBtn.textContent="ë”ë³´ê¸°"; moreBtn.onclick=()=>alert(moods[date].join("\n"));
  sec.appendChild(moreBtn);
}

// ===== ëŒ€ë‚˜ë¬´ìˆ² =====
function renderBamboo(){
  const ul=document.getElementById('bamboo-list'); ul.innerHTML='';
  const list=JSON.parse(localStorage.getItem('bamboo')||"[]");
  list.slice(-5).forEach(b=>{
    const li=document.createElement('li'); li.textContent=b.text;
    ul.appendChild(li);
  });
}

function showBambooDetail(){
  document.getElementById('portal-section').style.display='none';
  document.getElementById('bamboo-detail').style.display='block';
  renderBambooDetail();
}

function hideBambooDetail(){
  document.getElementById('bamboo-detail').style.display='none';
  document.getElementById('portal-section').style.display='block';
}

function showBambooWrite(){
  document.getElementById('bamboo-write').style.display='block';
}

function hideBambooWrite(){
  document.getElementById('bamboo-write').style.display='none';
}

function postBambooDetail(){
  const text=document.getElementById('bamboo-write-text').value.trim();
  if(!text) return;
  const list=JSON.parse(localStorage.getItem('bamboo')||"[]");
  list.push({text:text,user:currentUser.id,time:new Date().toLocaleString(),comments:[],like:0,dislike:0});
  localStorage.setItem('bamboo',JSON.stringify(list));
  document.getElementById('bamboo-write-text').value='';
  hideBambooWrite();
  renderBambooDetail();
}

let bambooPage=1;
const bambooPerPage=20;
function renderBambooDetail(){
  const ul=document.getElementById('bamboo-detail-list'); ul.innerHTML='';
  const list=JSON.parse(localStorage.getItem('bamboo')||"[]").filter(b=>b.user===currentUser.id);
  const start=(bambooPage-1)*bambooPerPage;
  const paged=list.slice(start,start+bambooPerPage);
  paged.forEach(b=>{
    const li=document.createElement('li'); li.textContent=b.text; ul.appendChild(li);
  });
  const pag=document.getElementById('bamboo-pagination'); pag.innerHTML='';
  const totalPage=Math.ceil(list.length/bambooPerPage);
  for(let i=1;i<=totalPage;i++){
    const btn=document.createElement('button'); btn.textContent=i;
    btn.onclick=(()=>{return ()=>{bambooPage=i; renderBambooDetail();}})();
    pag.appendChild(btn);
  }
}

</script>
</body>
</html>
