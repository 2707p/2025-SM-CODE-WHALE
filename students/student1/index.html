<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì°½ì› ì„±ë¯¼ì—¬ìê³ ë“±í•™êµ í¬í„¸</title>
<style>
  body { font-family: Arial; margin:0; padding:0; background:#f0f2f5; }
  #main { display:flex; transition: all 0.3s ease; }
  #sidebar { width:0; background:#fff; height:100vh; overflow:hidden; position:fixed; top:0; left:0; box-shadow:2px 0 5px rgba(0,0,0,0.1); transition: all 0.3s ease; padding-top:50px;}
  #sidebar button { display:block; width:90%; margin:10px auto; padding:8px; text-align:left; cursor:pointer; }
  #content { flex:1; padding:20px; margin-left:0; transition: all 0.3s ease;}
  .hidden { display:none; }
  h1,h2,h3 { color:#2c3e50; }
  input,button,select { padding:5px; margin:3px; }
  table { border-collapse: collapse; width:100%; text-align:center; margin-top:10px;}
  th, td { border:1px solid #ccc; padding:8px; }
  .calendar { display:flex; flex-wrap:wrap; width:300px; margin-top:10px; }
  .day { width:40px; height:40px; margin:2px; display:flex; align-items:center; justify-content:center; cursor:pointer; border-radius:5px; }
  .event { background:#f39c12; color:#fff; }
  .mood-btn { margin:3px; cursor:pointer; font-size:20px;}
  .mood-display { margin-top:5px; }
  #more-btn { cursor:pointer; padding:5px; background:#3498db; color:white; border:none; border-radius:3px; margin-top:5px;}
  #bamboo-list li { cursor:pointer; margin:5px 0; }
  #bamboo-detail-list li { margin:3px 0; }
  .pagination button { margin:2px; }
</style>
</head>
<body>

<!-- ë¡œê·¸ì¸ -->
<div id="login-screen">
  <h1>ì°½ì› ì„±ë¯¼ì—¬ìê³ ë“±í•™êµ í¬í„¸</h1>
  <input id="login-id" placeholder="ì•„ì´ë””">
  <input id="login-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <button onclick="login()">ë¡œê·¸ì¸</button>
  <p>ê³„ì •ì´ ì—†ë‚˜ìš”? <button onclick="showSignup()">íšŒì›ê°€ì…</button></p>
</div>

<!-- íšŒì›ê°€ì… -->
<div id="signup-screen" class="hidden">
  <h1>íšŒì›ê°€ì…</h1>
  <input id="signup-id" placeholder="ì•„ì´ë””">
  <input id="signup-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <input id="signup-grade" type="number" placeholder="í•™ë…„ (1~3)">
  <input id="signup-class" type="number" placeholder="ë°˜ (1~8)">
  <button onclick="signup()">ê°€ì…</button>
  <button onclick="hideSignup()">ì·¨ì†Œ</button>
</div>

<!-- ë©”ì¸ -->
<div id="main-screen" class="hidden">
  <button id="toggle-sidebar" onclick="toggleSidebar()">ë”ë³´ê¸° â˜°</button>
  <div id="sidebar">
    <button onclick="showProfile()">ê³„ì •</button>
    <button onclick="showPortal('ê³µì§€')">ê³µì§€</button>
    <button onclick="showPortal('ìº˜ë¦°ë”')">ìº˜ë¦°ë”</button>
    <button onclick="showPortal('ì‹œê°„í‘œ')">ì‹œê°„í‘œ</button>
    <button onclick="showPortal('ëŒ€ë‚˜ë¬´ìˆ²')">ëŒ€ë‚˜ë¬´ìˆ²</button>
    <button onclick="showPortal('ì…”í‹€ë²„ìŠ¤')">ì…”í‹€ë²„ìŠ¤</button>
    <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
  <div id="content">
    <!-- í”„ë¡œí•„ -->
    <div id="profile" class="hidden">
      <h2>ê°œì¸ í˜ì´ì§€</h2>
      <p>í”„ë¡œí•„ ì´ë¯¸ì§€: <input type="file" id="profile-img"></p>
      <p>ì´ë¦„: <input id="profile-name" placeholder="ì´ë¦„"></p>
      <p>í•™ë…„ë°˜: <span id="profile-gradeclass"></span></p>
      <p>ì•„ì´ë””: <span id="profile-id"></span></p>
      <p>ì§„ë¡œ: <input id="profile-career" placeholder="ì§„ë¡œ"></p>
      <button onclick="saveProfile()">ì €ì¥</button>
    </div>

    <!-- ê³µì§€ -->
    <div id="ê³µì§€" class="hidden">
      <h2>ê³µì§€</h2>
      <p>í•™êµ ê³µì§€ì‚¬í•­ ì˜ˆì‹œì…ë‹ˆë‹¤.</p>
    </div>

    <!-- ì‹œê°„í‘œ -->
    <div id="ì‹œê°„í‘œ" class="hidden">
      <h2>ì‹œê°„í‘œ</h2>
      <div id="timetable"></div>
    </div>

    <!-- ìº˜ë¦°ë” -->
    <div id="ìº˜ë¦°ë”" class="hidden">
      <h2>ìº˜ë¦°ë”</h2>
      <button onclick="changeMonth(-1)">â—€ ì´ì „</button>
      <span id="calendar-month"></span>
      <button onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
      <div class="calendar" id="calendar"></div>
      <div id="mood-section"></div>
    </div>

    <!-- ì…”í‹€ë²„ìŠ¤ -->
    <div id="ì…”í‹€ë²„ìŠ¤" class="hidden">
      <h2>ì…”í‹€ë²„ìŠ¤ ì •ë³´</h2>
      <ul id="bus-list"></ul>
    </div>

    <!-- ëŒ€ë‚˜ë¬´ìˆ² -->
    <div id="ëŒ€ë‚˜ë¬´ìˆ²" class="hidden">
      <h2>ëŒ€ë‚˜ë¬´ìˆ² ê²Œì‹œíŒ</h2>
      <button onclick="showBambooDetail()">ìì„¸íˆ ë³´ê¸°</button>
      <ul id="bamboo-list"></ul>
    </div>

    <!-- ëŒ€ë‚˜ë¬´ìˆ² ìƒì„¸ë³´ê¸° -->
    <div id="bamboo-detail" class="hidden">
      <h2>ëŒ€ë‚˜ë¬´ìˆ² ìƒì„¸ë³´ê¸°</h2>
      <button onclick="showBambooWrite()">ê¸€ì“°ê¸°</button>
      <div id="bamboo-write" class="hidden">
        <input type="text" id="bamboo-write-input" placeholder="ìµëª… ê¸€ ì‘ì„±...">
        <button onclick="postBambooDetail()">ê²Œì‹œ</button>
      </div>
      <input id="bamboo-search" placeholder="ì œëª©/ë‚´ìš© ê²€ìƒ‰" oninput="searchBamboo()">
      <ul id="bamboo-detail-list"></ul>
      <div class="pagination" id="bamboo-pagination"></div>
    </div>

  </div>
</div>

<script>
  // ===== ìœ ì € ë°ì´í„° =====
  let users = JSON.parse(localStorage.getItem('users')||"[]");
  let currentUser=null;

  function login(){
    const id=document.getElementById('login-id').value;
    const pw=document.getElementById('login-pw').value;
    const user=users.find(u=>u.id===id && u.password===pw);
    if(user){
      currentUser=user;
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('main-screen').classList.remove('hidden');
      document.getElementById('profile-gradeclass').textContent = `${user.grade}í•™ë…„ ${user.class}ë°˜`;
      document.getElementById('profile-id').textContent = user.id;
      showPortal('ê³µì§€');
      showTimetable(user);
      renderBusInfo();
      renderCalendar();
      showBamboo();
    } else alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
  }

  function logout(){ location.reload(); }

  function showSignup(){ document.getElementById('login-screen').classList.add('hidden'); document.getElementById('signup-screen').classList.remove('hidden'); }
  function hideSignup(){ document.getElementById('signup-screen').classList.add('hidden'); document.getElementById('login-screen').classList.remove('hidden'); }

  function signup(){
    const id=document.getElementById('signup-id').value.trim();
    const pw=document.getElementById('signup-pw').value.trim();
    const grade=parseInt(document.getElementById('signup-grade').value);
    const cls=parseInt(document.getElementById('signup-class').value);
    if(!id||!pw||!grade||!cls){ alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"); return;}
    if(users.some(u=>u.id===id)){ alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤."); return;}
    const newUser={id:id,password:pw,grade:grade,class:cls};
    users.push(newUser);
    localStorage.setItem('users', JSON.stringify(users));
    alert("íšŒì›ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.");
    hideSignup();
  }

  // ===== ì‚¬ì´ë“œë°” =====
  let sidebarOpen=false;
  function toggleSidebar(){
    sidebarOpen=!sidebarOpen;
    document.getElementById('sidebar').style.width = sidebarOpen?'25%':'0';
    document.getElementById('content').style.marginLeft = sidebarOpen?'25%':'0';
  }

  function showPortal(page){
    ['ê³µì§€','ì‹œê°„í‘œ','ìº˜ë¦°ë”','ì…”í‹€ë²„ìŠ¤','ëŒ€ë‚˜ë¬´ìˆ²','profile'].forEach(p=>document.getElementById(p).classList.add('hidden'));
    if(page==='ê³„ì •'){ showProfile(); return;}
    document.getElementById(page).classList.remove('hidden');
  }

  function showProfile(){ 
    document.getElementById('profile').classList.remove('hidden');
    ['ê³µì§€','ì‹œê°„í‘œ','ìº˜ë¦°ë”','ì…”í‹€ë²„ìŠ¤','ëŒ€ë‚˜ë¬´ìˆ²'].forEach(p=>document.getElementById(p).classList.add('hidden'));
  }

  function saveProfile(){
    currentUser.name=document.getElementById('profile-name').value;
    currentUser.career=document.getElementById('profile-career').value;
    localStorage.setItem('users', JSON.stringify(users));
    alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
  }

  // ===== ì‹œê°„í‘œ =====
  const timetables = {
    "1-1":[["êµ­ì–´","ìˆ˜í•™","ì˜ì–´","ê³¼í•™","ì²´ìœ¡"],["ì˜ì–´","ìˆ˜í•™","êµ­ì–´","ë¯¸ìˆ ","ì²´ìœ¡"],["ì—­ì‚¬","ìŒì•…","ë¯¸ìˆ ","ê³¼í•™","ì˜ì–´"],["ê³¼í•™","ì²´ìœ¡","êµ­ì–´","ìˆ˜í•™","ìŒì•…"],["ì˜ì–´","ê³¼í•™","ì²´ìœ¡","ì—­ì‚¬","ìŒì•…"]],
    "2-7":[["êµ­ì–´","ìˆ˜í•™","ì˜ì–´","ê³¼í•™","ì²´ìœ¡"],["êµ­ì–´","ìˆ˜í•™","ì˜ì–´","ê³¼í•™","ì²´ìœ¡"],["ì—­ì‚¬","ìŒì•…","ë¯¸ìˆ ","ì •ë³´","ì˜ì–´"],["ê³¼í•™","ì²´ìœ¡","êµ­ì–´","ìˆ˜í•™","ì˜ì–´"],["ì˜ì–´","ê³¼í•™","ì²´ìœ¡","ì—­ì‚¬","ìŒì•…"]],
    "2-8":[["ìˆ˜í•™","êµ­ì–´","ì˜ì–´","ë¯¸ìˆ ","ì²´ìœ¡"],["ìˆ˜í•™","êµ­ì–´","ì˜ì–´","ìŒì•…","ì²´ìœ¡"],["ì—­ì‚¬","ê³¼í•™","êµ­ì–´","ì˜ì–´","ì²´ìœ¡"],["ê³¼í•™","ì˜ì–´","êµ­ì–´","ì²´ìœ¡","ìŒì•…"],["ì˜ì–´","ì²´ìœ¡","ìˆ˜í•™","ê³¼í•™","ì—­ì‚¬"]],
    "3-1":[["êµ­ì–´","ì˜ì–´","ìˆ˜í•™","ê³¼í•™","ì²´ìœ¡"],["êµ­ì–´","ìŒì•…","ìˆ˜í•™","ì²´ìœ¡","ì˜ì–´"],["ì—­ì‚¬","ê³¼í•™","ë¯¸ìˆ ","ì˜ì–´","ì²´ìœ¡"],["ê³¼í•™","ì²´ìœ¡","êµ­ì–´","ìˆ˜í•™","ì˜ì–´"],["ì˜ì–´","ê³¼í•™","ì²´ìœ¡","ì—­ì‚¬","ìŒì•…"]]
  };

  function showTimetable(user){
    const key = `${user.grade}-${user.class}`;
    const tableDiv = document.getElementById('timetable');
    tableDiv.innerHTML="";
    const table = document.createElement('table');
    const days = ["ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ"];
    const thead = document.createElement('thead');
    const tr = document.createElement('tr');
    tr.innerHTML="<th>êµì‹œ</th>"+days.map(d=>`<th>${d}</th>`).join("");
    thead.appendChild(tr);
    table.appendChild(thead);
    const tbody = document.createElement('tbody');
    if(!timetables[key]){ 
      for(let i=0;i<5;i++){
        const tr = document.createElement('tr');
        tr.innerHTML="<td>"+(i+1)+"êµì‹œ</td>"+Array(5).fill('<td>-</td>').join("");
        tbody.appendChild(tr);
      }
    } else {
      for(let i=0;i<5;i++){
        const tr = document.createElement('tr');
        tr.innerHTML="<td>"+(i+1)+"êµì‹œ</td>"+timetables[key][i].map(c=>`<td>${c}</td>`).join("");
        tbody.appendChild(tr);
      }
    }
    table.appendChild(tbody);
    tableDiv.appendChild(table);
  }

  // ===== ì…”í‹€ë²„ìŠ¤ =====
  const buses=[{route:"Aì½”ìŠ¤",status:"ìš´í–‰ì¤‘",next:"08:30"},{route:"Bì½”ìŠ¤",status:"ì§€ì—°",next:"08:45"}];
  function renderBusInfo(){
    const busList=document.getElementById('bus-list');
    busList.innerHTML="";
    buses.forEach(b=>{
      const li=document.createElement('li');
      li.textContent=`${b.route} - ${b.status} (ë‹¤ìŒ: ${b.next})`;
      busList.appendChild(li);
    });
  }

  // ===== ìº˜ë¦°ë” + ë§ˆìŒì˜¨ë„ =====
  let currentMonth=new Date();
  const events=[{date:"2025-09-05",title:"ì²´ìœ¡ëŒ€íšŒ"},{date:"2025-09-10",title:"ê³¼í•™ì „ì‹œíšŒ"}];
  let moodsData=JSON.parse(localStorage.getItem('moods')||"{}");

  function renderCalendar(){
    const calendar=document.getElementById('calendar');
    calendar.innerHTML="";
    const year=currentMonth.getFullYear();
    const month=currentMonth.getMonth();
    document.getElementById('calendar-month').textContent=`${year}ë…„ ${month+1}ì›”`;

    const firstDay=new Date(year,month,1).getDay();
    const lastDate=new Date(year,month+1,0).getDate();

    for(let i=0;i<firstDay;i++){
      const div=document.createElement('div'); div.className='day'; div.style.visibility='hidden'; calendar.appendChild(div);
    }
    for(let d=1;d<=lastDate;d++){
      const div=document.createElement('div'); div.className='day';
      const dateStr=`${year}-${(month+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
      div.textContent=d;
      if(events.some(e=>e.date===dateStr)){ div.classList.add('event'); div.onclick=()=>selectMood(dateStr);}
      calendar.appendChild(div);
    }
  }
  function changeMonth(dir){ currentMonth.setMonth(currentMonth.getMonth()+dir); renderCalendar();}
  function selectMood(date){
    const emojis=["ğŸ˜„","ğŸ˜“","ğŸ˜","ğŸ˜¢"];
    const section=document.getElementById('mood-section');
    section.innerHTML=`<h3>${date} ë§ˆìŒì˜¨ë„</h3>`;
    emojis.forEach(e=>{
      const btn=document.createElement('button'); btn.textContent=e; btn.className='mood-btn';
      btn.onclick=()=>{
        moodsData[date]=moodsData[date]||[]; 
        moodsData[date].push({user:currentUser.id,emoji:e}); 
        localStorage.setItem('moods',JSON.stringify(moodsData)); 
        showMood(date);
      };
      section.appendChild(btn);
    });
    showMood(date);
  }
  function showMood(date){
    const section=document.getElementById('mood-section');
    const div=document.createElement('div'); div.className='mood-display';
    const userMoods = moodsData[date].filter(m=>m.user===currentUser.id).map(m=>m.emoji);
    div.textContent=userMoods.join(" ");
    section.appendChild(div);
    const moreBtn=document.createElement('button'); moreBtn.textContent="ë”ë³´ê¸°"; moreBtn.id="more-btn";
    moreBtn.onclick=()=>alert(moodsData[date].map(m=>m.emoji).join("\n"));
    section.appendChild(moreBtn);
  }

  // ===== ëŒ€ë‚˜ë¬´ìˆ² ê¸°ë³¸ =====
  function showBamboo(){
    const list=JSON.parse(localStorage.getItem('bamboo')||"[]").filter(b=>b.user===currentUser.id);
    const ul=document.getElementById('bamboo-list'); ul.innerHTML='';
    list.forEach(item=>{ const li=document.createElement('li'); li.textContent=`${item.text}`; ul.appendChild(li); });
  }

  // ===== ëŒ€ë‚˜ë¬´ìˆ² ìƒì„¸ =====
  function showBambooDetail(){
    document.getElementById('ëŒ€ë‚˜ë¬´ìˆ²').classList.add('hidden');
    document.getElementById('bamboo-detail').classList.remove('hidden');
    document.getElementById('bamboo-write').classList.add('hidden');
    renderBambooDetail();
  }
  function hideBambooDetail(){
    document.getElementById('bamboo-detail').classList.add('hidden');
    document.getElementById('ëŒ€ë‚˜ë¬´ìˆ²').classList.remove('hidden');
  }
  function showBambooWrite(){
    document.getElementById('bamboo-write').classList.toggle('hidden');
  }

  function postBambooDetail(){
    const input=document.getElementById('bamboo-write-input');
    const text=input.value.trim(); if(!text) return;
    const list=JSON.parse(localStorage.getItem('bamboo')||"[]");
    list.push({user:currentUser.id,text:text,time:new Date().toLocaleString()});
    localStorage.setItem('bamboo',JSON.stringify(list));
    input.value=''; renderBambooDetail();
  }

  const itemsPerPage=20; let currentPage=1;
  function renderBambooDetail(){
    const list=JSON.parse(localStorage.getItem('bamboo')||"[]").filter(b=>b.user===currentUser.id);
    const filteredList = list.filter(b=>{
      const s = document.getElementById('bamboo-search').value.toLowerCase();
      return b.text.toLowerCase().includes(s);
    });
    const ul=document.getElementById('bamboo-detail-list'); ul.innerHTML='';
    const start=(currentPage-1)*itemsPerPage;
    const end=start+itemsPerPage;
    filteredList.slice(start,end).forEach(item=>{
      const li=document.createElement('li');
      li.textContent=item.text;
      ul.appendChild(li);
    });

    const pageDiv=document.getElementById('bamboo-pagination');
    pageDiv.innerHTML='';
    const totalPages=Math.ceil(filteredList.length/itemsPerPage);
    for(let i=1;i<=totalPages;i++){
      const btn=document.createElement('button');
      btn.textContent=i;
      btn.onclick=(()=>{ 
        const page=i; 
        return ()=>{ currentPage=page; renderBambooDetail(); };
      })();
      pageDiv.appendChild(btn);
    }
  }

  function searchBamboo(){ currentPage=1; renderBambooDetail(); }

</script>
</body>
</html>
