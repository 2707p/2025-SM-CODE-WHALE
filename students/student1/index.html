<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì°½ì› ì„±ë¯¼ì—¬ìê³ ë“±í•™êµ í¬í„¸</title>
<style>
body { font-family: Arial; background: #f9f9f9; padding:20px;}
h1,h2 { color:#2c3e50;}
section { margin-bottom:20px; background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1);}
table { border-collapse: collapse; width: 100%; text-align:center; }
th, td { border:1px solid #ccc; padding:8px;}
.calendar { display:flex; flex-wrap:wrap; width:300px; margin-bottom:10px; }
.day { width:40px; height:40px; margin:2px; display:flex; align-items:center; justify-content:center; cursor:pointer; border-radius:5px; }
.event { background-color:#f39c12; color:white;}
.mood-btn { margin:3px; cursor:pointer; font-size:20px;}
.mood-display { margin-top:5px; }
.bamboo { margin-top:10px; }
input[type="text"], input[type="password"], input[type="number"] { padding:5px; margin:3px;}
.pagination { margin-top:10px; }
.pagination button { margin:2px; }
</style>
</head>
<body>

<h1>ì°½ì› ì„±ë¯¼ì—¬ìê³ ë“±í•™êµ í¬í„¸</h1>

<!-- ë¡œê·¸ì¸ -->
<section id="login-section">
  <h2>ë¡œê·¸ì¸</h2>
  <input id="login-id" placeholder="ì•„ì´ë””">
  <input id="login-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <button id="loginBtn">ë¡œê·¸ì¸</button>
  <p>ê³„ì •ì´ ì—†ë‚˜ìš”? <button id="signupBtn">íšŒì›ê°€ì…</button></p>
</section>

<!-- íšŒì›ê°€ì… -->
<section id="signup-section" style="display:none">
  <h2>íšŒì›ê°€ì…</h2>
  <input id="signup-id" placeholder="ì•„ì´ë””">
  <input id="signup-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <input id="signup-grade" type="number" placeholder="í•™ë…„">
  <input id="signup-class" type="number" placeholder="ë°˜">
  <button id="createBtn">ê°€ì…í•˜ê¸°</button>
  <button id="cancelBtn">ì·¨ì†Œ</button>
</section>

<!-- í¬í„¸ -->
<section id="portal-section" style="display:none">
  <button id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>

  <!-- ì‹œê°„í‘œ -->
  <section>
    <h2>ì‹œê°„í‘œ</h2>
    <div id="timetable"></div>
  </section>

  <!-- ìº˜ë¦°ë” -->
  <section>
    <h2>ìº˜ë¦°ë”</h2>
    <div>
      <button id="prevMonth">â—€ ì´ì „</button>
      <span id="calendar-month"></span>
      <button id="nextMonth">ë‹¤ìŒ â–¶</button>
    </div>
    <div class="calendar" id="calendar"></div>
    <div id="mood-section"></div>
  </section>

  <!-- ì…”í‹€ë²„ìŠ¤ -->
  <section>
    <h2>ì…”í‹€ë²„ìŠ¤ ì •ë³´</h2>
    <ul id="bus-list"></ul>
  </section>

  <!-- ëŒ€ë‚˜ë¬´ìˆ² -->
  <section>
    <h2>ëŒ€ë‚˜ë¬´ìˆ² ê²Œì‹œíŒ</h2>
    <div class="bamboo">
      <button id="bamboo-detail-btn">ìì„¸íˆ ë³´ê¸°</button>
    </div>
    <ul id="bamboo-list"></ul>
  </section>
</section>

<!-- ëŒ€ë‚˜ë¬´ìˆ² ìƒì„¸ í˜ì´ì§€ -->
<section id="bamboo-detail" style="display:none">
  <h2>ëŒ€ë‚˜ë¬´ìˆ² ìƒì„¸ë³´ê¸°</h2>
  <div style="text-align:right;">
    <input type="text" id="bamboo-detail-input" placeholder="ê¸€ ì‘ì„±...">
    <button id="bamboo-post-btn">ì‘ì„±</button>
    <button id="bamboo-close-btn">ë‹«ê¸°</button>
    <input type="text" id="bamboo-search" placeholder="ê²€ìƒ‰(ì œëª©/ë‚´ìš©)">
    <button id="bamboo-search-btn">ê²€ìƒ‰</button>
  </div>
  <ul id="bamboo-detail-list"></ul>
  <div class="pagination" id="bamboo-pagination"></div>
</section>

<script>
window.onload = function(){

  // ===== ìœ ì € ë°ì´í„° =====
  let users = JSON.parse(localStorage.getItem('users')||"[]");
  let currentUser = null;

  // ===== DOM =====
  const loginSection = document.getElementById('login-section');
  const signupSection = document.getElementById('signup-section');
  const portalSection = document.getElementById('portal-section');
  const bambooDetailSection = document.getElementById('bamboo-detail');

  // ===== ì´ë²¤íŠ¸ ì—°ê²° =====
  document.getElementById('loginBtn').onclick = login;
  document.getElementById('signupBtn').onclick = showSignup;
  document.getElementById('cancelBtn').onclick = hideSignup;
  document.getElementById('createBtn').onclick = signup;
  document.getElementById('logoutBtn').onclick = logout;
  document.getElementById('prevMonth').onclick = ()=>{changeMonth(-1);};
  document.getElementById('nextMonth').onclick = ()=>{changeMonth(1);};
  document.getElementById('bamboo-detail-btn').onclick = showBambooDetail;
  document.getElementById('bamboo-close-btn').onclick = hideBambooDetail;
  document.getElementById('bamboo-post-btn').onclick = postBambooDetail;
  document.getElementById('bamboo-search-btn').onclick = searchBamboo;

  // ===== ë¡œê·¸ì¸/íšŒì›ê°€ì… =====
  function login(){
    const id = document.getElementById('login-id').value;
    const pw = document.getElementById('login-pw').value;
    const user = users.find(u=>u.id===id && u.password===pw);
    if(user){
      alert(`ë¡œê·¸ì¸ ì„±ê³µ! ${user.grade}í•™ë…„ ${user.class}ë°˜`);
      currentUser = user;
      localStorage.setItem('currentUser', JSON.stringify(user));
      loginSection.style.display='none';
      portalSection.style.display='block';
      showTimetable(user);
      renderCalendar();
      renderBusInfo();
      showBamboo();
    } else alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
  }

  function logout(){
    localStorage.removeItem('currentUser');
    location.reload();
  }

  function showSignup(){ loginSection.style.display='none'; signupSection.style.display='block'; }
  function hideSignup(){ signupSection.style.display='none'; loginSection.style.display='block'; }

  function signup(){
    const id=document.getElementById('signup-id').value.trim();
    const pw=document.getElementById('signup-pw').value.trim();
    const grade=parseInt(document.getElementById('signup-grade').value);
    const cls=parseInt(document.getElementById('signup-class').value);
    if(!id||!pw||!grade||!cls){ alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"); return;}
    if(users.some(u=>u.id===id)){ alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤."); return;}
    const newUser={id:id,password:pw,grade:grade,class:cls};
    users.push(newUser);
    localStorage.setItem('users', JSON.stringify(users));
    alert("íšŒì›ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.");
    hideSignup();
  }

  // ===== ì‹œê°„í‘œ =====
  const days = ["ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ"];
  function generateDummyTimetable(){ // 1~3í•™ë…„ 1~8ë°˜
    const subjects = ["êµ­ì–´","ìˆ˜í•™","ì˜ì–´","ê³¼í•™","ì²´ìœ¡","ì—­ì‚¬","ìŒì•…","ë¯¸ìˆ ","ì •ë³´"];
    let t = {};
    for(let g=1; g<=3; g++){
      for(let c=1; c<=8; c++){
        const key=`${g}-${c}`;
        t[key] = [];
        for(let i=0;i<5;i++){
          let row = [];
          for(let j=0;j<5;j++){
            row.push(subjects[Math.floor(Math.random()*subjects.length)]);
          }
          t[key].push(row);
        }
      }
    }
    return t;
  }
  const timetables = generateDummyTimetable();
  function showTimetable(user){
    const key = `${user.grade}-${user.class}`;
    const tableDiv = document.getElementById('timetable');
    tableDiv.innerHTML="";
    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const tr = document.createElement('tr');
    tr.innerHTML="<th>êµì‹œ</th>"+days.map(d=>`<th>${d}</th>`).join("");
    thead.appendChild(tr);
    table.appendChild(thead);
    const tbody=document.createElement('tbody');
    for(let i=0;i<5;i++){
      const tr = document.createElement('tr');
      tr.innerHTML="<td>"+(i+1)+"êµì‹œ</td>"+timetables[key][i].map(c=>`<td>${c}</td>`).join("");
      tbody.appendChild(tr);
    }
    table.appendChild(tbody);
    tableDiv.appendChild(table);
  }

  // ===== ì…”í‹€ë²„ìŠ¤ =====
  const buses=[{route:"Aì½”ìŠ¤",status:"ìš´í–‰ì¤‘",next:"08:30"},{route:"Bì½”ìŠ¤",status:"ì§€ì—°",next:"08:45"}];
  function renderBusInfo(){
    const busList=document.getElementById('bus-list');
    busList.innerHTML="";
    buses.forEach(b=>{
      const li=document.createElement('li');
      li.textContent=`${b.route} - ${b.status} (ë‹¤ìŒ: ${b.next})`;
      busList.appendChild(li);
    });
  }

  // ===== ìº˜ë¦°ë” + ë§ˆìŒì˜¨ë„ =====
  let currentMonth = new Date();
  const events=[{date:"2025-09-05",title:"ì²´ìœ¡ëŒ€íšŒ"},{date:"2025-09-10",title:"ê³¼í•™ì „ì‹œíšŒ"}];
  let moodsData = JSON.parse(localStorage.getItem('moods')||"{}");

  function renderCalendar(){
    const calendar=document.getElementById('calendar');
    calendar.innerHTML="";
    const year=currentMonth.getFullYear();
    const month=currentMonth.getMonth();
    document.getElementById('calendar-month').textContent=`${year}ë…„ ${month+1}ì›”`;
    const firstDay=new Date(year,month,1).getDay();
    const lastDate=new Date(year,month+1,0).getDate();
    for(let i=0;i<firstDay;i++){
      const div=document.createElement('div'); div.className='day'; div.style.visibility='hidden'; calendar.appendChild(div);
    }
    for(let d=1;d<=lastDate;d++){
      const div=document.createElement('div'); div.className='day';
      const dateStr=`${year}-${(month+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
      div.textContent=d;
      if(events.some(e=>e.date===dateStr)){ div.classList.add('event'); div.onclick=()=>selectMood(dateStr);}
      calendar.appendChild(div);
    }
  }
  function changeMonth(dir){ currentMonth.setMonth(currentMonth.getMonth()+dir); renderCalendar(); }
  function selectMood(date){
    const key = `${currentUser.grade}-${currentUser.class}`;
    moodsData[key] = moodsData[key]||{};
    moodsData[key][date] = moodsData[key][date]||[];
    const section=document.getElementById('mood-section');
    section.innerHTML=`<h3>${date} ë§ˆìŒì˜¨ë„</h3>`;
    ["ğŸ˜„","ğŸ˜“","ğŸ˜","ğŸ˜¢"].forEach(e=>{
      const btn=document.createElement('button'); btn.textContent=e; btn.className='mood-btn';
      btn.onclick=()=>{ moodsData[key][date].push(e); localStorage.setItem('moods',JSON.stringify(moodsData)); showMood(date); };
      section.appendChild(btn);
    });
    showMood(date);
  }
  function showMood(date){
    const key = `${currentUser.grade}-${currentUser.class}`;
    const section=document.getElementById('mood-section');
    const div=document.createElement('div'); div.className='mood-display';
    div.textContent=`ì´ ${moodsData[key][date].length}ê°œ ì‘ë‹µ`;
    section.appendChild(div);
    const moreBtn=document.createElement('button'); moreBtn.textContent="ë”ë³´ê¸°"; moreBtn.onclick=()=>alert(moodsData[key][date].join("\n"));
    section.appendChild(moreBtn);
  }

  // ===== ëŒ€ë‚˜ë¬´ìˆ² (ë°˜ë³„) =====
  function showBamboo(){
    const key=`${currentUser.grade}-${currentUser.class}`;
    const list=JSON.parse(localStorage.getItem(`bamboo_${key}`)||"[]");
    const ul=document.getElementById('bamboo-list'); ul.innerHTML='';
    list.forEach(item=>{
      const li=document.createElement('li');
      li.textContent=`${item.text}`;
      ul.appendChild(li);
    });
  }

  // ===== ëŒ€ë‚˜ë¬´ìˆ² ìƒì„¸ =====
  let currentPage=1, itemsPerPage=20;
  function showBambooDetail(){
    portalSection.style.display='none';
    bambooDetailSection.style.display='block';
    currentPage=1;
    renderBambooDetail();
  }
  function hideBambooDetail(){ bambooDetailSection.style.display='none'; portalSection.style.display='block'; }

  function postBambooDetail(){
    const input=document.getElementById('bamboo-detail-input');
    const text=input.value.trim(); if(!text) return;
    const key=`${currentUser.grade}-${currentUser.class}`;
    const list=JSON.parse(localStorage.getItem(`bamboo_${key}`)||"[]");
    list.push({text:text,time:new Date().toLocaleString(),views:0,comments:[],likes:0,dislikes:0});
    localStorage.setItem(`bamboo_${key}`,JSON.stringify(list));
    input.value=''; renderBambooDetail();
  }

  function renderBambooDetail(){
    const key=`${currentUser.grade}-${currentUser.class}`;
    let list=JSON.parse(localStorage.getItem(`bamboo_${key}`)||"[]");
    const search = document.getElementById('bamboo-search').value.trim().toLowerCase();
    if(search) list = list.filter(x=>x.text.toLowerCase().includes(search));
    const ul=document.getElementById('bamboo-detail-list'); ul.innerHTML='';
    const start=(currentPage-1)*itemsPerPage;
    const end=start+itemsPerPage;
    list.slice(start,end).forEach((item,index)=>{
      const li=document.createElement('li');
      li.textContent=item.text;
      li.style.cursor='pointer';
      li.onclick=()=>alert(`ê¸€ ë‚´ìš©: ${item.text}`);
      ul.appendChild(li);
    });
    // pagination
    const totalPages=Math.ceil(list.length/itemsPerPage);
    const pageDiv=document.getElementById('bamboo-pagination'); pageDiv.innerHTML='';
    for(let i=1;i<=totalPages;i++){
      const btn=document.createElement('button');
      btn.textContent=i;
      if(i===currentPage) btn.disabled=true;
      btn.onclick=()=>{currentPage=i; renderBambooDetail();}
      pageDiv.appendChild(btn);
    }
  }

};
</script>

</body>
</html>
