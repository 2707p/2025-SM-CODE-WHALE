<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì°½ì› ì„±ë¯¼ì—¬ìê³ ë“±í•™êµ í¬í„¸</title>
<style>
  body { font-family: Arial; padding: 20px; background: #f9f9f9; }
  h1, h2 { color: #2c3e50; }
  section { margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
  table { border-collapse: collapse; width: 100%; text-align: center; }
  th, td { border: 1px solid #ccc; padding: 8px; }
  .calendar { display: flex; flex-wrap: wrap; width: 300px; margin-bottom: 10px; }
  .day { width: 40px; height: 40px; margin: 2px; display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 5px; }
  .event { background-color: #f39c12; color: white; }
  .mood-btn { margin: 3px; cursor: pointer; font-size: 20px;}
  .mood-display { margin-top: 5px; }
  .bamboo { margin-top: 10px; }
  input[type="text"], input[type="password"], input[type="number"] { padding: 5px; margin: 3px; }
  .pagination { margin-top:10px; text-align:center; }
  .pagination button { margin:2px; }
  .btn { cursor:pointer; padding:5px 10px; margin:3px; border-radius:5px; border:none; background:#3498db; color:white; }
  .btn:hover { background:#2980b9; }
</style>
</head>
<body>

<h1>ì°½ì› ì„±ë¯¼ì—¬ìê³ ë“±í•™êµ í¬í„¸</h1>

<!-- ë¡œê·¸ì¸ -->
<section id="login-section">
  <h2>ë¡œê·¸ì¸</h2>
  <input id="login-id" placeholder="ì•„ì´ë””">
  <input id="login-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <button class="btn" onclick="login()">ë¡œê·¸ì¸</button>
</section>

<!-- í¬í„¸ -->
<section id="portal-section" style="display:none">
  <button class="btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>

  <!-- ì‹œê°„í‘œ -->
  <section>
    <h2>ì‹œê°„í‘œ</h2>
    <div id="timetable"></div>
  </section>

  <!-- ìº˜ë¦°ë” -->
  <section>
    <h2>ìº˜ë¦°ë”</h2>
    <div>
      <button class="btn" onclick="changeMonth(-1)">â—€ ì´ì „</button>
      <span id="calendar-month"></span>
      <button class="btn" onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
    </div>
    <div class="calendar" id="calendar"></div>
    <div id="mood-section"></div>
  </section>

  <!-- ì…”í‹€ë²„ìŠ¤ -->
  <section>
    <h2>ì…”í‹€ë²„ìŠ¤ ì •ë³´</h2>
    <ul id="bus-list"></ul>
  </section>

  <!-- ëŒ€ë‚˜ë¬´ìˆ² -->
  <section>
    <h2>ëŒ€ë‚˜ë¬´ìˆ² ê²Œì‹œíŒ</h2>
    <button class="btn" onclick="showBambooPage()">ìì„¸íˆ ë³´ê¸°</button>
  </section>
</section>

<!-- ëŒ€ë‚˜ë¬´ìˆ² ìƒì„¸ í˜ì´ì§€ -->
<section id="bamboo-page" style="display:none">
  <h2>ëŒ€ë‚˜ë¬´ìˆ² ìƒì„¸ë³´ê¸°</h2>
  <div>
    <button class="btn" onclick="showWriteForm()">ê¸€ì“°ê¸°</button>
    <input type="text" id="bamboo-search" placeholder="ì œëª©/ë‚´ìš© ê²€ìƒ‰">
    <button class="btn" onclick="renderBambooDetail()">ê²€ìƒ‰</button>
  </div>
  <div id="write-form" style="display:none;">
    <input type="text" id="bamboo-title" placeholder="ì œëª©">
    <textarea id="bamboo-content" placeholder="ë‚´ìš©" rows="3" style="width:100%;"></textarea>
    <button class="btn" onclick="postBambooDetail()">ê²Œì‹œ</button>
    <button class="btn" onclick="hideWriteForm()">ì·¨ì†Œ</button>
  </div>
  <table id="bamboo-list-table" style="width:100%; margin-top:10px;">
    <thead><tr><th>ìµëª…</th><th>ì œëª©</th><th>ì‘ì„±ì¼</th><th>ì¡°íšŒìˆ˜</th></tr></thead>
    <tbody id="bamboo-detail-list"></tbody>
  </table>
  <div class="pagination" id="bamboo-pagination"></div>
  <button class="btn" onclick="closeBambooPage()">ë‹«ê¸°</button>
</section>

<script>
  // ===== ì´ˆê¸° ìœ ì € =====
  let users=[{id:"student1", password:"1234", grade:2, class:7}];
  localStorage.setItem('users', JSON.stringify(users));

  function login(){
    const id=document.getElementById('login-id').value;
    const pw=document.getElementById('login-pw').value;
    users=JSON.parse(localStorage.getItem('users')||"[]");
    const user=users.find(u=>u.id===id && u.password===pw);
    if(user){
      alert(`ë¡œê·¸ì¸ ì„±ê³µ! ${user.grade}í•™ë…„ ${user.class}ë°˜`);
      localStorage.setItem('currentUser', JSON.stringify(user));
      document.getElementById('login-section').style.display='none';
      document.getElementById('portal-section').style.display='block';
      showTimetable(user);
      renderCalendar();
      renderBusInfo();
    } else alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
  }

  function logout(){
    localStorage.removeItem('currentUser');
    location.reload();
  }

  // ===== ì‹œê°„í‘œ =====
  const timetables={
    "2-7":[["êµ­ì–´","ìˆ˜í•™","ì˜ì–´","ê³¼í•™","ì²´ìœ¡"],["êµ­ì–´","ìˆ˜í•™","ì˜ì–´","ê³¼í•™","ì²´ìœ¡"],["ì—­ì‚¬","ìŒì•…","ë¯¸ìˆ ","ì •ë³´","ì˜ì–´"],["ê³¼í•™","ì²´ìœ¡","êµ­ì–´","ìˆ˜í•™","ì˜ì–´"],["ì˜ì–´","ê³¼í•™","ì²´ìœ¡","ì—­ì‚¬","ìŒì•…"]],
    "2-8":[["ìˆ˜í•™","êµ­ì–´","ì˜ì–´","ë¯¸ìˆ ","ì²´ìœ¡"],["ìˆ˜í•™","êµ­ì–´","ì˜ì–´","ìŒì•…","ì²´ìœ¡"],["ì—­ì‚¬","ê³¼í•™","êµ­ì–´","ì˜ì–´","ì²´ìœ¡"],["ê³¼í•™","ì˜ì–´","êµ­ì–´","ì²´ìœ¡","ìŒì•…"],["ì˜ì–´","ì²´ìœ¡","ìˆ˜í•™","ê³¼í•™","ì—­ì‚¬"]]
  };
  function showTimetable(user){
    const key=`${user.grade}-${user.class}`;
    const tableDiv=document.getElementById('timetable');
    tableDiv.innerHTML="";
    const table=document.createElement('table');
    const days=["ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ"];
    const thead=document.createElement('thead');
    const tr=document.createElement('tr');
    tr.innerHTML="<th>êµì‹œ</th>"+days.map(d=>`<th>${d}</th>`).join("");
    thead.appendChild(tr);
    table.appendChild(thead);
    const tbody=document.createElement('tbody');
    for(let i=0;i<5;i++){
      const tr=document.createElement('tr');
      tr.innerHTML="<td>"+(i+1)+"êµì‹œ</td>"+(timetables[key][i]||["","","","",""]).map(c=>`<td>${c}</td>`).join("");
      tbody.appendChild(tr);
    }
    table.appendChild(tbody);
    tableDiv.appendChild(table);
  }

  // ===== ì…”í‹€ë²„ìŠ¤ =====
  const buses=[{route:"Aì½”ìŠ¤",status:"ìš´í–‰ì¤‘",next:"08:30"},{route:"Bì½”ìŠ¤",status:"ì§€ì—°",next:"08:45"}];
  function renderBusInfo(){
    const busList=document.getElementById('bus-list');
    busList.innerHTML="";
    buses.forEach(b=>{
      const li=document.createElement('li');
      li.textContent=`${b.route} - ${b.status} (ë‹¤ìŒ: ${b.next})`;
      busList.appendChild(li);
    });
  }

  // ===== ìº˜ë¦°ë” + ë§ˆìŒì˜¨ë„ =====
  let currentMonth=new Date();
  const events=[{date:"2025-09-05",title:"ì²´ìœ¡ëŒ€íšŒ"},{date:"2025-09-10",title:"ê³¼í•™ì „ì‹œíšŒ"}];
  let moodsData=JSON.parse(localStorage.getItem('moods')||"{}");

  function renderCalendar(){
    const calendar=document.getElementById('calendar');
    calendar.innerHTML="";
    const year=currentMonth.getFullYear();
    const month=currentMonth.getMonth();
    document.getElementById('calendar-month').textContent=`${year}ë…„ ${month+1}ì›”`;

    const firstDay=new Date(year,month,1).getDay();
    const lastDate=new Date(year,month+1,0).getDate();

    for(let i=0;i<firstDay;i++){
      const div=document.createElement('div'); div.className='day'; div.style.visibility='hidden'; calendar.appendChild(div);
    }
    for(let d=1;d<=lastDate;d++){
      const div=document.createElement('div'); div.className='day';
      const dateStr=`${year}-${(month+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
      div.textContent=d;
      if(events.some(e=>e.date===dateStr)){ div.classList.add('event'); div.onclick=()=>selectMood(dateStr);}
      calendar.appendChild(div);
    }
  }
  function changeMonth(dir){ currentMonth.setMonth(currentMonth.getMonth()+dir); renderCalendar();}
  function selectMood(date){
    const emojis=["ğŸ˜„","ğŸ˜“","ğŸ˜","ğŸ˜¢"];
    const section=document.getElementById('mood-section');
    section.innerHTML=`<h3>${date} ë§ˆìŒì˜¨ë„</h3>`;
    emojis.forEach(e=>{
      const btn=document.createElement('button'); btn.textContent=e; btn.className='mood-btn';
      btn.onclick=()=>{ moodsData[date]=moodsData[date]||[]; moodsData[date].push(e); localStorage.setItem('moods',JSON.stringify(moodsData)); showMood(date);};
      section.appendChild(btn);
    });
    showMood(date);
  }
  function showMood(date){
    const section=document.getElementById('mood-section');
    const div=document.createElement('div'); div.className='mood-display';
    div.textContent=`ë”ë³´ê¸°: ${ (moodsData[date]||[]).length }ê°œ`;
    section.appendChild(div);
    const moreBtn=document.createElement('button'); moreBtn.textContent="ë”ë³´ê¸°"; moreBtn.onclick=()=>alert(moodsData[date].join("\n"));
    section.appendChild(moreBtn);
  }

  // ===== ëŒ€ë‚˜ë¬´ìˆ² ê¸°ë³¸ í˜ì´ì§€ =====
  function showBambooPage(){
    document.getElementById('portal-section').style.display='none';
    document.getElementById('bamboo-page').style.display='block';
    renderBambooDetail();
  }
  function closeBambooPage(){
    document.getElementById('bamboo-page').style.display='none';
    document.getElementById('portal-section').style.display='block';
  }

  // ===== ëŒ€ë‚˜ë¬´ìˆ² ìƒì„¸ =====
  let bambooPosts=JSON.parse(localStorage.getItem('bambooPosts')||"[]");
  let currentBambooPage=1; const bambooPerPage=20;

  function showWriteForm(){ document.getElementById('write-form').style.display='block'; }
  function hideWriteForm(){ document.getElementById('write-form').style.display='none'; }

  function postBambooDetail(){
    const title=document.getElementById('bamboo-title').value.trim();
    const content=document.getElementById('bamboo-content').value.trim();
    if(!title || !content){ alert("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return;}
    bambooPosts.unshift({title, content, date:new Date().toLocaleString(), views:0, comments:[], rec:0, deRec:0});
    localStorage.setItem('bambooPosts', JSON.stringify(bambooPosts));
    document.getElementById('bamboo-title').value=''; document.getElementById('bamboo-content').value='';
    hideWriteForm(); renderBambooDetail();
  }

  function renderBambooDetail(){
    const tbody=document.getElementById('bamboo-detail-list');
    tbody.innerHTML="";
    const search=document.getElementById('bamboo-search').value.trim().toLowerCase();
    let filtered=bambooPosts;
    if(search) filtered=bambooPosts.filter(p=>p.title.toLowerCase().includes(search)||p.content.toLowerCase().includes(search));

    const totalPage=Math.ceil(filtered.length/bambooPerPage);
    if(currentBambooPage>totalPage) currentBambooPage=1;
    const start=(currentBambooPage-1)*bambooPerPage;
    const pagePosts=filtered.slice(start,start+bambooPerPage);

    pagePosts.forEach((p,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>ìµëª…</td><td><a href="#" onclick="viewBambooPost(${start+i})">${p.title}</a></td><td>${p.date}</td><td>${p.views}</td>`;
      tbody.appendChild(tr);
    });

    const pagDiv=document.getElementById('bamboo-pagination');
    pagDiv.innerHTML="";
    for(let i=1;i<=totalPage;i++){
      const btn=document.createElement('button'); btn.textContent=i; btn.className='btn';
      btn.onclick=(()=>{ return ()=>{ currentBambooPage=i; renderBambooDetail(); }})(i);
      pagDiv.appendChild(btn);
    }
  }

  function viewBambooPost(idx){
    const post=bambooPosts[idx];
    post.views+=1;
    localStorage.setItem('bambooPosts', JSON.stringify(bambooPosts));
    alert(`ì œëª©: ${post.title}\në‚´ìš©: ${post.content}\nì¶”ì²œ:${post.rec} ë¹„ì¶”ì²œ:${post.deRec}\nëŒ“ê¸€:${post.comments.length}ê°œ`);
    renderBambooDetail();
  }

</script>
</body>
</html>
