<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>창원 성민여자고등학교 포털</title>
<style>
body { font-family: Arial; padding: 20px; background: #f9f9f9; }
h1, h2 { color: #2c3e50; }
section { margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
table { border-collapse: collapse; width: 100%; text-align: center; }
th, td { border: 1px solid #ccc; padding: 8px; }
.calendar { display: flex; flex-wrap: wrap; width: 300px; margin-bottom: 10px; }
.day { width: 40px; height: 40px; margin: 2px; display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 5px; }
.event { background-color: #f39c12; color: white; }
.mood-btn { margin: 3px; cursor: pointer; font-size: 20px;}
.mood-display { margin-top: 5px; }
.bamboo { margin-top: 10px; }
input[type="text"], input[type="password"], input[type="number"] { padding: 5px; margin: 3px; }
.pagination { margin-top:10px; }
.pagination button { margin:2px; }
.comment { margin-left:20px; font-size:14px; }
</style>
</head>
<body>

<h1>창원 성민여자고등학교 포털</h1>

<section id="login-section">
  <h2>로그인</h2>
  <input id="login-id" placeholder="아이디">
  <input id="login-pw" type="password" placeholder="비밀번호">
  <button onclick="login()">로그인</button>
  <p>계정이 없나요? <button onclick="showSignup()">회원가입</button></p>
</section>

<section id="signup-section" style="display:none">
  <h2>회원가입</h2>
  <input id="signup-id" placeholder="아이디">
  <input id="signup-pw" type="password" placeholder="비밀번호">
  <input id="signup-grade" type="number" placeholder="학년(1~3)">
  <input id="signup-class" type="number" placeholder="반(1~8)">
  <button onclick="signup()">가입하기</button>
  <button onclick="hideSignup()">취소</button>
</section>

<section id="portal-section" style="display:none">
  <button onclick="logout()">로그아웃</button>

  <section>
    <h2>시간표</h2>
    <div id="timetable"></div>
  </section>

  <section>
    <h2>캘린더</h2>
    <div>
      <button onclick="changeMonth(-1)">◀ 이전</button>
      <span id="calendar-month"></span>
      <button onclick="changeMonth(1)">다음 ▶</button>
    </div>
    <div class="calendar" id="calendar"></div>
    <div id="mood-section"></div>
  </section>

  <section>
    <h2>셔틀버스 정보</h2>
    <ul id="bus-list"></ul>
  </section>

  <section>
    <h2>대나무숲 게시판</h2>
    <div class="bamboo">
      <input type="text" id="bamboo-input" placeholder="익명 글 작성...">
      <button onclick="postBamboo()">게시</button>
      <button onclick="showBambooDetail()">자세히 보기</button>
    </div>
    <ul id="bamboo-list"></ul>
  </section>
</section>

<section id="bamboo-detail" style="display:none">
  <h2>대나무숲 상세보기</h2>
  <div>
    <input type="text" id="bamboo-detail-input" placeholder="익명 글 작성...">
    <button onclick="postBambooDetail()">게시</button>
    <button onclick="hideBambooDetail()">닫기</button>
  </div>
  <ul id="bamboo-detail-list"></ul>
  <div class="pagination" id="bamboo-pagination"></div>
</section>

<script>
// ===== 데이터 초기화 =====
let users = JSON.parse(localStorage.getItem('users')||"[]");
let moodsData = JSON.parse(localStorage.getItem('moods')||"{}");
let bambooPosts = JSON.parse(localStorage.getItem('bamboo')||"[]");

// ===== 회원가입/로그인 =====
function showSignup(){ document.getElementById('login-section').style.display='none'; document.getElementById('signup-section').style.display='block'; }
function hideSignup(){ document.getElementById('signup-section').style.display='none'; document.getElementById('login-section').style.display='block'; }

function signup(){
  const id = document.getElementById('signup-id').value.trim();
  const pw = document.getElementById('signup-pw').value.trim();
  const grade = parseInt(document.getElementById('signup-grade').value);
  const cls = parseInt(document.getElementById('signup-class').value);

  if(!id || !pw || isNaN(grade) || isNaN(cls)){
    alert("모든 항목을 정확히 입력해주세요!");
    return;
  }
  if(grade<1 || grade>3){ alert("학년은 1~3학년만 가능합니다."); return; }
  if(cls<1 || cls>8){ alert("반은 1~8반만 가능합니다."); return; }
  if(users.some(u=>u.id===id)){ alert("이미 존재하는 아이디입니다."); return; }

  const newUser = {id:id, password:pw, grade:grade, class:cls};
  users.push(newUser);
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('currentUser', JSON.stringify(newUser));

  alert("회원가입 완료! 자동 로그인됩니다.");
  document.getElementById('signup-section').style.display='none';
  document.getElementById('portal-section').style.display='block';
  showTimetable(newUser);
  renderCalendar();
  renderBusInfo();
  showBamboo();
}

function login(){
  const id=document.getElementById('login-id').value.trim();
  const pw=document.getElementById('login-pw').value.trim();
  const user=users.find(u=>u.id===id && u.password===pw);
  if(user){
    localStorage.setItem('currentUser', JSON.stringify(user));
    document.getElementById('login-section').style.display='none';
    document.getElementById('portal-section').style.display='block';
    showTimetable(user);
    renderCalendar();
    renderBusInfo();
    showBamboo();
  } else alert('아이디 또는 비밀번호가 틀렸습니다.');
}
function logout(){ localStorage.removeItem('currentUser'); location.reload(); }

// ===== 시간표 =====
const timetables = {};
for(let g=1; g<=3; g++){
  for(let c=1; c<=8; c++){
    timetables[`${g}-${c}`] = [
      ["국어","수학","영어","과학","체육"],
      ["영어","역사","수학","음악","체육"],
      ["과학","국어","미술","체육","영어"],
      ["수학","과학","체육","영어","음악"],
      ["체육","영어","역사","미술","과학"]
    ];
  }
}

function showTimetable(user){
  const key = `${user.grade}-${user.class}`;
  const tableDiv = document.getElementById('timetable'); tableDiv.innerHTML="";
  const table = document.createElement('table');
  const days = ["월","화","수","목","금"];
  const thead = document.createElement('thead');
  const tr = document.createElement('tr'); tr.innerHTML="<th>교시</th>"+days.map(d=>`<th>${d}</th>`).join(""); thead.appendChild(tr); table.appendChild(thead);
  const tbody = document.createElement('tbody');
  for(let i=0;i<5;i++){
    const tr = document.createElement('tr');
    tr.innerHTML="<td>"+(i+1)+"교시</td>"+timetables[key][i].map(c=>`<td>${c}</td>`).join("");
    tbody.appendChild(tr);
  }
  table.appendChild(tbody); tableDiv.appendChild(table);
}

// ===== 셔틀버스 =====
const buses=[{route:"A코스",status:"운행중",next:"08:30"},{route:"B코스",status:"지연",next:"08:45"}];
function renderBusInfo(){
  const busList=document.getElementById('bus-list'); busList.innerHTML="";
  buses.forEach(b=>{
    const li=document.createElement('li'); li.textContent=`${b.route} - ${b.status} (다음: ${b.next})`; busList.appendChild(li);
  });
}

// ===== 캘린더 + 마음온도 =====
let currentMonth = new Date();
const events = [{date:"2025-09-05",title:"체육대회"},{date:"2025-09-10",title:"과학전시회"}];

function renderCalendar(){
  const calendar=document.getElementById('calendar'); calendar.innerHTML="";
  const year=currentMonth.getFullYear(); const month=currentMonth.getMonth();
  document.getElementById('calendar-month').textContent=`${year}년 ${month+1}월`;
  const firstDay=new Date(year,month,1).getDay();
  const lastDate=new Date(year,month+1,0).getDate();
  for(let i=0;i<firstDay;i++){ const div=document.createElement('div'); div.className='day'; div.style.visibility='hidden'; calendar.appendChild(div);}
  for(let d=1
